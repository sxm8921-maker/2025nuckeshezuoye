<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>密码与安全设置</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
    <style>
        .password-strength {
            margin-top: 5px;
            font-size: 12px;
        }
        .strength-weak {
            color: #FF5722;
        }
        .strength-medium {
            color: #FFB800;
        }
        .strength-strong {
            color: #009688;
        }
    </style>
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">

        <div class="layui-row">
            <div class="layui-col-md6">
                <form class="layui-form" lay-filter="passwordForm">
                    <div class="layui-form-item">
                        <label class="layui-form-label required">旧密码</label>
                        <div class="layui-input-block">
                            <input type="password" name="old_password" lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    
                    <div class="layui-form-item">
                        <label class="layui-form-label required">新密码</label>
                        <div class="layui-input-block">
                            <input type="password" name="new_password" id="newPassword" lay-verify="required|passRule" autocomplete="off" class="layui-input">
                            <div class="password-strength" id="strengthIndicator"></div>
                        </div>
                    </div>
                    
                    <div class="layui-form-item">
                        <label class="layui-form-label required">确认新密码</label>
                        <div class="layui-input-block">
                            <input type="password" name="confirm_password" lay-verify="required|repass" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    
                    <div class="layui-form-item">
                         <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="passwordSubmit">修改密码</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

    </div>
</div>
<script src="../../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script>
    layui.use(['form', 'jquery', 'layer'], function () {
        var $ = layui.jquery,
            form = layui.form,
            layer = layui.layer;

        // 自定义验证规则
        form.verify({
            passRule: function(value){
                if(value.length < 8){
                    return '密码长度不能小于8位';
                }
                var hasLetter = /[a-zA-Z]/.test(value);
                var hasNumber = /[0-9]/.test(value);
                var hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(value);
                var typeCount = 0;
                if(hasLetter) typeCount++;
                if(hasNumber) typeCount++;
                if(hasSpecial) typeCount++;
                
                if(typeCount < 2){
                    return '密码需包含数字、字母、特殊符号中的任意两种';
                }
            },
            repass: function(value){
                if(value !== $('[name=new_password]').val()){
                    return '两次输入的密码不一致！';
                }
            }
        });

        // 实时检查密码强度
        $('#newPassword').on('keyup', function(){
            var password = $(this).val();
            var strength = getPasswordStrength(password);
            var $indicator = $('#strengthIndicator');
            
            $indicator.removeClass('strength-weak strength-medium strength-strong');
            
            if(strength === 'weak'){
                $indicator.addClass('strength-weak').text('强度：弱');
            } else if(strength === 'medium'){
                $indicator.addClass('strength-medium').text('强度：中');
            } else if(strength === 'strong'){
                $indicator.addClass('strength-strong').text('强度：强');
            } else {
                $indicator.text('');
            }
        });

        // 密码强度判断函数
        function getPasswordStrength(password){
            if(password.length < 8){
                return 'weak';
            }
            
            var hasLetter = /[a-zA-Z]/.test(password);
            var hasNumber = /[0-9]/.test(password);
            var hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
            var typeCount = 0;
            if(hasLetter) typeCount++;
            if(hasNumber) typeCount++;
            if(hasSpecial) typeCount++;
            
            if(typeCount >= 3){
                return 'strong';
            } else if(typeCount >= 2){
                return 'medium';
            } else {
                return 'weak';
            }
        }

        // 监听表单提交
        form.on('submit(passwordSubmit)', function(data){
            layer.msg('密码修改成功！', {icon: 1});
            return false;
        });
    });
</script>
</body>
</html>