<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>综合统计分析</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
    <style>
        .data-tip {
            border-left: 5px solid #009688;
            padding: 15px;
            background-color: #f2f2f2;
            margin-bottom: 20px;
        }
        .trend-up {
            color: #009688;
        }
        .trend-down {
            color: #FF5722;
        }
    </style>
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">

        <fieldset class="layui-elem-field layui-field-title">
            <legend>月度销售额报表</legend>
        </fieldset>
        <div id="monthlyReportTable">
            <table class="layui-hide" id="salesReportTable" lay-filter="salesReportTable"></table>
        </div>

        <hr/>
        
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>数据提示与自定义统计</legend>
        </fieldset>
        
        <div class="data-tip">
            <p><strong>数据分析提示：</strong></p>
            <p>近 3 个月发动机零件销量增长 20%，建议增加采购。</p>
        </div>
        
        <div class="layui-card">
            <div class="layui-card-header">自定义统计</div>
            <div class="layui-card-body">
                <form class="layui-form" lay-filter="customStatForm">
                    <div class="layui-form-item">
                        <label class="layui-form-label">统计标题</label>
                        <div class="layui-input-block">
                            <input type="text" name="stat_title" required lay-verify="required" placeholder="请输入统计报表标题" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">时间范围</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input" id="dateRange" placeholder="请选择统计时间范围" readonly>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="generateStat">生成统计</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>统计结果</legend>
        </fieldset>
        <div id="customStatResult" style="display: none;">
            <p id="statTitleDisplay" style="text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 15px;"></p>
            <table class="layui-hide" id="customStatTable" lay-filter="customStatTable"></table>
        </div>
        

    </div>
</div>
<script src="../../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script>
    layui.use(['form', 'table', 'layer', 'laydate'], function () {
        var $ = layui.jquery,
            form = layui.form,
            table = layui.table,
            layer = layui.layer,
            laydate = layui.laydate;

        // 模拟月度销售数据
        var monthlySalesData = [
            {month: '2024-01', sales: 50000, trend: 'up'},
            {month: '2024-02', sales: 60000, trend: 'up'},
            {month: '2024-03', sales: 55000, trend: 'down'},
            {month: '2024-04', sales: 72000, trend: 'up'},
            {month: '2024-05', sales: 85000, trend: 'up'},
            {month: '2024-06', sales: 81000, trend: 'down'},
            {month: '2024-07', sales: 90000, trend: 'up'}
        ];

        // 渲染月度销售报表表格
        table.render({
            elem: '#salesReportTable',
            data: monthlySalesData,
            cols: [[
                {field: 'month', width: 120, title: '月份', sort: true},
                {field: 'sales', title: '销售额 (元)'},
                {field: 'trend', width: 80, title: '趋势', templet: function(d){
                    if(d.trend === 'up'){
                        return '<span class="trend-up">↑</span>';
                    } else if(d.trend === 'down'){
                        return '<span class="trend-down">↓</span>';
                    }
                    return '-';
                }}
            ]],
            skin: 'line',
            limit: 10
        });

        // 渲染日期范围选择器
        laydate.render({
            elem: '#dateRange',
            range: true
        });

        // 监听自定义统计表单提交
        form.on('submit(generateStat)', function(data){
            var title = data.field.stat_title;
            var dateRange = $('#dateRange').val();
            
            if(!dateRange){
                layer.msg('请选择统计时间范围！', {icon: 5});
                return false;
            }

            var dates = dateRange.split(' - ');
            var startDate = dates[0];
            var endDate = dates[1];

            // 模拟根据时间范围生成的统计数据
            var customData = [
                { item: '发动机零件', sales: 150000, percentage: '25%', rank: 1 },
                { item: '车身零件', sales: 120000, percentage: '20%', rank: 2 },
                { item: '电子零件', sales: 90000, percentage: '15%', rank: 3 }
            ];
            
            // 显示标题和表格区域
            $('#statTitleDisplay').text(title + ' (' + startDate + ' 至 ' + endDate + ')');
            $('#customStatResult').show();

            // 渲染自定义统计表格
            table.render({
                elem: '#customStatTable',
                data: customData,
                cols: [[
                    {field: 'item', title: '零件类型'},
                    {field: 'sales', title: '销售总额 (元)'},
                    {field: 'percentage', title: '总额占比'},
                    {field: 'rank', title: '排名'}
                ]],
                skin: 'row'
            });

            layer.msg('统计报表已生成！', {icon: 1});
            return false;
        });

    });
</script>
</body>
</html>